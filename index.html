<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/solarized.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<style type="text/css">
			.left {
				left:-8.33%;
				text-align: left;
				float: left;
				width:50%;
				z-index:-10;
			  }
			  
			  .right {
				left:31.25%;
				top: 75px;
				float: right;
				text-align: right;
				z-index:-10;
				width:50%;
			  }
			  .img {
				  max-height: 98% !important;
				  max-width: 98% !important;
			  }

		</style>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<!-- Me in Ember-->
				<section>
					<h2>M3 Introduction</h2>
					<div class="right">
						<h3 style="margin-right: 130px">Igor Terzic</h3>
					</div>
										<aside class="notes">
							- Client web frameworks
							- ember data and ember.js framework core teams
							- Ember since 2012
							- LinkedIn since November
						</aside>

				</section>
				<section>
						<h2>M3</h2>
					<div class="fragment">
					<h2>Frontend Data Handling in Ember</h2>
					</div>
				</section>
				<section>
					<h2>Frontend Data Handling in Ember</h2>
				</section>
				<section>
          <h2>Raw Ajax</h2>
				</section>
				<section>
						<h2>jQuery</h2>
					<div class="fragment">
          <h2>fetch</h2>
					</div>
					<div class="fragment">
          <h2>xhr service</h2>
					</div>
				</section>
        <section>
						<pre><code data-trim contenteditable>
/**
	* XHR service to allow fetching API data without using Ember Data.
  *
  * @module Services
  * @class xhr
  */
  export default Service.extend({
		locale: inject(),
		tracking: inject(),
		pemberlyNetwork: inject(),
		fetch(url, settings = {}, ttl = null) {
			const acceptedMethod = ['GET', 'POST', undefined];
		...
	)}
					</code></pre>
					<aside class="notes">
					</aside>
        </section>
				<section>
						<pre><code data-trim contenteditable>
yield this.xhr.post(`${API_ENDPOINTS.lisaAccounts}/${accountId}`, {
	headers: { 'x-restli-method': 'partial_update' },
	data: JSON.stringify(postData),
});
					</code></pre>
        </section>
				<section>
          <h2>Ember Data</h2>
				</section>
				<section>
						<pre><code data-trim contenteditable>
/**
* The model for account.
*
* @module Models
* @class account
*/
export default DS.Model.extend(Validations, {
 /**
	* Billing parent reference id for the account
	* Enterprise only
	*
	* @property
	*/
 billingParentReferenceId: DS.attr('string'),

 /**
	* Billing parent reference type for the account
	* Enterprise only
	*
	* @property
	*/
 billingParentReferenceType: DS.attr('string'),

 /**
	* Billing reference id for the account
	* Enterprise only
	* Optional
	*
	* @property
	*/
 billingReferenceId: DS.attr('string'),
					</code></pre>
				</section>
				<section>
						<pre><code data-trim contenteditable>
  * Task to open edit campaign group modal
  *
  * @method openCampaignGroupEditModal
  * @public
  */
  openCampaignGroupEditModal: task(function*(id) {
    const campaignGroupModel = yield this.store.findRecord('campaignGroup', id);
    this.set('campaignGroupToModify', campaignGroupModel);
    this.set('isEditCampaignGroupModal', true);
    this.set('isCampaignGroupAddEditModalOpen', true);
  }).drop(),	
					</code></pre>
				</section>
				<section>
          <h2>Tradeoffs</h2>
					<aside class="notes">
						campaign manager uses both
						what we can do to make the tradeoffs not as bad
					</aside>
				</section>
				<section>
          <h2>Ember Data</h2>
				</section>
				<section>
					<h2>Caching</h2>
						<pre><code data-trim contenteditable>
let campaignGroup = await this.store.findRecord('campaignGroup', id);
					</code></pre>
				</section>
				<section>
          <h2>Modeling</h2>
						<pre><code data-trim contenteditable>
/**
* The model for account.
*
* @module Models
* @class account
*/
export default DS.Model.extend(Validations, {
 /**
	* Billing parent reference id for the account
	* Enterprise only
	*
	* @property
	*/
 billingParentReferenceId: DS.attr('string'),
 ... 
});
					</code></pre>
				</section>
				<section>
          <h2>Schemas</h2>
						<pre><code data-trim contenteditable>
/**
* The model for account.
*
* @module Models
* @class account
*/
export default DS.Model.extend(Validations, {
 /**
	* Billing parent reference id for the account
	* Enterprise only
	*
	* @property
	*/
 billingParentReferenceId: DS.attr('string'),
 ... 
});
					</code></pre>
				</section>

				<section>
          <h2>Conventional</h2>
          <h2>Adapter/Serializer</h2>
					<aside class="notes">
						All of the api logic in one place
					</aside>
				</section>
				<section>
          <h2>Common functionality and support</h2>
					<aside class="notes">
						Both from the community and internally
					</aside>
				</section>
				<section>
          <h2>Ember Data</h2>
          <h3>Caching</h3>
          <h3>Modeling</h3>
          <h3>Schemas</h3>
          <h3>Conventional</h3>
          <h3>Common functionality and support</h3>
				</section>
				<section>
          <h2>Raw Ajax</h2>
				</section>
				<section>
          <h2>Straightforward</h2>
				</section>
				<section>
						<pre><code data-trim contenteditable>
const accountInfo = await this.xhr.fetch(`${API_ENDPOINTS.lisaAccounts}/${accountId}`);
					</code></pre>
				</section>
				<section>
          <h2>Fast</h2>
					<aside class="notes">
Tradeoff as the app grows, and lots of custom code etc
					</aside>
				</section>
				<section>
          <h2>Easy to access nested properties</h2>
					<aside class="notes">
Look at the network tab, if there access it, if not go bother the api team
					</aside>
				</section>
				<section>
          <h2>Flexible</h2>
				</section>
				<section>
						<h2>Raw Ajax</h2>
						<h3>Straightforward</h3>
						<h3>Fast</h3>
						<h3>Easy to access nested properties</h3>
						<h3>Flexible</h3>
					</section>
					<section>
							<h2>Schemas</h2>
								<pre><code data-trim contenteditable>
		/**
		* The model for account.
		*
		* @module Models
		* @class account
		*/
		export default DS.Model.extend(Validations, {
		 /**
			* Billing parent reference id for the account
			* Enterprise only
			*
			* @property
			*/
		 billingParentReferenceId: DS.attr('string'),
		 ... 
		});
							</code></pre>

					<aside class="notes">
						Mismatch given that LI already has PDSCs
						</section>
				<section>
          <h2>Campaign manager uses both</h2>
					<aside class="notes">
A perfectly sensible choice
A use case mmismatch between ED and some of LIs use cases
					</aside>
				</section>

				<section>
          <h2>M3</h2>
				</section>
				<section>
          <p>Ember Data addon that brings XHR benefits to Ember Data</p>
        </section>
				<section>
          <h3>Ember Data challenges</h3>
					<aside class="notes">
            Three pillars of M3
					</aside>
        </section>
				<section>
          <h2>Performance</h2>
        </section>
				<section>
          <h2>Models</h2>
        </section>
				<section>
          <h2>Models</h2>
						<pre><code data-trim contenteditable>
/**
* The model for account.
*
* @module Models
* @class account
*/
export default DS.Model.extend(Validations, {
 /**
	* Billing parent reference id for the account
	* Enterprise only
	*
	* @property
	*/
 billingParentReferenceId: DS.attr('string'),
 ... 
});
					</code></pre>
				</section>
				<section>
					<h2>Payload size</h2>
					<div class="fragment">
						65kb
					</div>
        </section>
				<section>
          <h2>Initializing Time</h2>
        </section>
				<section>
					<h2>Payload size</h2>
					<div class="fragment">
						65kb
					</div>
        </section>
				<section>
          <h2>Models</h2>
						<pre><code data-trim contenteditable>
/**
* The model for account.
*
* @module Models
* @class account
*/
export default DS.Model.extend(Validations, {
 /**
	* Billing parent reference id for the account
	* Enterprise only
	*
	* @property
	*/
 billingParentReferenceId: DS.attr('string'),
 ... 
});
					</code></pre>
					<aside class="notes">
						For not that much benefit, to be able to access the payload you already have with xhr
					</aside>
				</section>
				<section>
          <h2>Initializing Time</h2>
        </section>
				<section>
          <p>MegaMorphicModel</p>
        </section>
				<section>
<pre><code data-trim contenteditable>
const MegaMorphicModel =  Ember.Object.extend({
  ...
})
</code></pre>
        </section>
				<section>
<pre><code data-trim contenteditable>
	let entity = await store.findRecord('com.linkedin.campaignmanager.content.CmSponsorableContent', 'urn:li:1');
	entity.get('someProperty')
</code></pre>
        </section>
				<section>
          <h2>Payload Processing</h2>
					<aside class="notes">
						Other Performance improvements
Much lighter weight normalizing process and buffered caching
					</aside>
        </section>
				<section>
          <h2>Buffered Caching</h2>
        </section>
				<section>
          <h2>M3 goals</h2>
          <h3>Performance</h3>
        </section>
				<section>
          <h2>Nested Data access</h2>
        </section>
				<section>
					<pre><code data-trim contenteditable>
{
"urn:li:ugcPost:6541385448718159872": {
	"accountId": 507468353,
	"companyId": 17995238,
	"lastModifiedAt": 1559587824165,
	"lifecycleState": "PROCESSING",
	"lifecycleStateInfo": {
		"com.linkedin.ugc.ProcessingStateInfo": {
			"assetStatus": "PROCESSING"
		}
	},
	"name": "Sample Video",
	"shareContent": {
		"commentary": "Sample Video Intro",
		"contentEntities": [
			{
				"image": {
					"url": "https://dms.licdn.com/video-thumbs/C4E10AQFMBw-EZHL5FA/fac3e37f94c34d469d60c0322263da29/ads-videocover_540_v2/960x540-00001.jpg"
				},
				"landingPageTitle": "LEARN_MORE",
				"landingPageUrl": "http://linkedin.com/ads/",
				"recipes": [
					"VIDEO_ADS_V2"
				],
				"title": "My Awesome Headline",
				"urn": "urn:li:digitalmediaAsset:C4E10AQFMBw-EZHL5FA",
				"video": {
					"aspectRatioHeight": 9.0,
					"aspectRatioWidth": 16.0,
					"duration": 15083,
					"url": "https://dms.licdn.com/playback/C4E10AQFMBw-EZHL5FA/517a5ae00bf340b7a57d59f4b19eeae4/ads-mp4_3300_v2/1539653675477-jctfxc?e=1559692800&v=beta&t=XYWqjOpp-C7g6uNje3Xs_TweKQ6X-nRzJvSRnZ_Qkt8"
				}
			}
		],
		"contentType": "VIDEO"
	},
	"urn": "urn:li:ugcPost:6541385448718159872",
	"visibility": "DARK"
}
							</code></pre>
					<aside class="notes">
Sponsorable Content
					</aside>
        </section>
				<section>
					<pre><code data-trim contenteditable>
  getSponsorableContentsByUrns(urns) {
    return this.xhr
      .fetch(
        `${API_ENDPOINTS.sponsorableContents}?ids=${encoder.encode(urns)}`,
        {
          type: 'GET',
        },
        0
      )
      .then(({ results = {} }) => Object.keys(results).map(urn => results[urn]));
							</code></pre>
				</section>
				<section>
						<pre><code data-trim contenteditable>
let record = await store.findRecord('com.linkedin.campaignmanager.content.CmSponsorableContent', 
  'urn:li:ugcPost:6541385448718159872')
							</code></pre>
				</section>
				<section>
					<pre><code data-trim contenteditable>
{{#each record.content.shareContent.contentEntities as |entity|}}
  {{entity.video.url}}
{{/each}}
							</code></pre>
        </section>
				<section>
					<pre><code data-trim contenteditable>
{{#each record.content.shareContent.contentEntities as |entity|}}
  {{entity.isNew}}
  {{entity.video.url}}
{{/each}}
							</code></pre>
        </section>
				<section>
          <h2>M3 goals</h2>
          <h3>Performance</h3>
          <h3>Nested Data access</h3>
        </section>
				<section>
          <h2>Advanced features and DX</h2>
        </section>
				<section>
          <h2>Query Caching</h2>
					<pre><code data-trim contenteditable>
store.queryURL('/newsfeed/latest', { cacheKey: 'newsfeed.latest', backgroundReload: true });
					</code></pre>
        </section>
				<section>
          <h2>Deco Projections</h2>
        </section>
				<section>
						<h2>M3 goals</h2>
						<h3>Performance</h3>
						<h3>Nested Data access</h3>
					<h3>Advanced features and DX</h3>
				</section>
				<section>
          <h2>M3</h2>
				</section>
				<section>
          <p>How does m3 fit in the ecosystem</p>
				</section>
				<section>
          <h3>Ember Data Addon</h3>
				</section>
				<section>
          <h3>Supports interop with ember data</h3>
				</section>
				<section>
          <h3>Open source</h3>
				</section>
				<section>
					<h3>https://github.com/hjdivad/ember-m3</h3>
				</section>
				<section>
          <h3>Customized and prepackaged for pemberly-api</h3>
				</section>
				<section>
					<h3>https://git.corp.linkedin.com:1367/plugins/gitiles/multiproducts/ember-cli-pemberly-m3</h3>
				</section>
				<section>
					<h2>ember-data -> ember-m3 -> ember-cli-pemberly-m3</h3>
				</section>
				<section>
					<h3>ember-data -> ember-cli-pemberly-m3</h3>
				</section>
				<section>
					<h2>Current State</h2>
				</section>
				<section>
					<h2>Works</h2>
					<aside class="notes">
						Fully ramped in voyager
					</aside>
				</section>
				<section>
					<h2>Fast</h2>
				</section>
				<section>
					<h2>Documented</h2>
				</section>
				<section>
					<h2>Supported</h2>
				</section>
				<section>
					<h2>go/pemberly/web</h2>
				</section>
				<section>
					<h2>Production ready</h2>
				</section>
				<section>
					<h2>Future plans</h2>
				</section>
				<section>
					<h2>DX improvements</h2>
					<aside class="notes">
						Debugging, nicer Restli projections etc.
					</aside>
				</section>
				<section>
					<h2>m3 functionality in ember data</h2>
				</section>
				<section>
					<h2>GraphQL support</h2>
				</section>
				<section>
          <h2>
          Thanks!
          </h2>
					</aside>

        </section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				width: '100%',
				height: '100%',
        margin: '0',
        fragments: true,
        history: true,
        keyboard: {
          38: 'prev', // go to the next slide when the ENTER key is pressed
          40: 'next', // go to the next slide when the ENTER key is pressed

        },


				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
